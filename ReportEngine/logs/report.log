2025-11-25 22:35:18.527 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-11-25 22:35:18.529 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-11-25 22:35:18.530 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-11-25 22:35:18.531 | INFO     | agent:generate_report:197 - 开始生成报告: Generate an English ESG performance report for Alibaba Group's 2024 sustainability efforts
2025-11-25 22:35:18.531 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 351
2025-11-25 22:35:18.532 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-11-25 22:35:18.534 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-11-25 22:35:18.534 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-11-25 22:35:18.535 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-11-25 22:35:18.536 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-11-25 22:35:18.536 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-11-25 22:35:18.537 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-11-25 22:35:18.537 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-11-25 22:35:18.538 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-11-25 22:36:19.451 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 36124 字符
2025-11-25 22:36:19.453 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 36112 字符
2025-11-25 22:36:19.453 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-11-25 22:36:19.453 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-11-25 22:36:19.455 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251125_223619.html
2025-11-25 22:36:19.457 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251125_223619.json
2025-11-25 22:36:19.458 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 60.93 秒
2025-11-29 06:34:24.710 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-11-29 06:34:24.713 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-11-29 06:34:24.714 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-11-29 06:34:28.854 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-11-29 06:34:28.855 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-11-29 06:34:28.855 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-11-29 06:34:28.856 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-11-29 06:34:28.856 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-11-29 06:34:28.857 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-11-29 06:34:28.857 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-11-29 06:34:28.858 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-11-29 06:34:28.858 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-11-29 06:34:28.860 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-11-29 06:34:28.863 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-11-29 06:35:23.868 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 31036 字符
2025-11-29 06:35:23.869 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 31028 字符
2025-11-29 06:35:23.870 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-11-29 06:35:23.870 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-11-29 06:35:23.896 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251129_063523.html
2025-11-29 06:35:23.901 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251129_063523.json
2025-11-29 06:35:23.904 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 55.05 秒
2025-12-01 20:53:59.641 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-01 20:53:59.645 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-01 20:53:59.645 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-01 20:54:03.752 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-01 20:54:03.754 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-01 20:54:03.754 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-01 20:54:03.755 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-01 20:54:03.755 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-01 20:54:03.755 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-01 20:54:03.756 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-01 20:54:03.756 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-01 20:54:03.757 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-01 20:54:03.757 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-01 20:54:03.759 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-01 20:54:05.887 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
2025-12-01 20:54:05.887 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x000002889B14C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x000002889B14C0E0>
             └ <agent.ReportAgent object at 0x000002889B13F0D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-01\n[PortfolioAgent]: Analyzed 6 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 6 stocks with total value ₹13,949.41. Overall P&L: ₹1,197.19 (+9.39%)', 'key_...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x000002889B14C220>
                  └ <agent.ReportAgent object at 0x000002889B13F0D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x000002889B0A20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002889B6CFA50>
                   └ <agent.ReportAgent object at 0x000002889B13F0D0>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x000002889B087560>
               │    └ <llms.base.LLMClient object at 0x000002889B36F4D0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002889B6CFA50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x000002889B086FC0>
                 └ <llms.base.LLMClient object at 0x000002889B36F4D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x000002889B987560>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002889B77F190>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x000002889B77EF90>
             │    └ <openai.OpenAI object at 0x000002889B6CD550>
             └ <llms.base.LLMClient object at 0x000002889B36F4D0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002889B77F190>,)
           └ <function Completions.create at 0x000002889B987380>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002889B6CD550>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002889B77F190>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000028899F345E0>
           │    │          └ <openai.OpenAI object at 0x000002889B6CD550>
           │    └ ~ResponseT
           └ <function cast at 0x0000028896234FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000028899F2ED40>
          └ <openai.OpenAI object at 0x000002889B6CD550>

openai.PermissionDeniedError: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
2025-12-01 20:54:06.137 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-01 20:54:06.138 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x000002889B087560>
               │    └ <llms.base.LLMClient object at 0x000002889B36F4D0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002889B6CFA50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x000002889B086FC0>
                 └ <llms.base.LLMClient object at 0x000002889B36F4D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x000002889B987560>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002889B77F190>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x000002889B77EF90>
             │    └ <openai.OpenAI object at 0x000002889B6CD550>
             └ <llms.base.LLMClient object at 0x000002889B36F4D0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002889B77F190>,)
           └ <function Completions.create at 0x000002889B987380>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002889B6CD550>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002889B77F190>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000028899F345E0>
           │    │          └ <openai.OpenAI object at 0x000002889B6CD550>
           │    └ ~ResponseT
           └ <function cast at 0x0000028896234FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000028899F2ED40>
          └ <openai.OpenAI object at 0x000002889B6CD550>

openai.PermissionDeniedError: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x000002889B14C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x000002889B14C0E0>
             └ <agent.ReportAgent object at 0x000002889B13F0D0>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-01\n[PortfolioAgent]: Analyzed 6 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 6 stocks with total value ₹13,949.41. Overall P&L: ₹1,197.19 (+9.39%)', 'key_...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x000002889B14C220>
                  └ <agent.ReportAgent object at 0x000002889B13F0D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x000002889B0A20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002889B6CFA50>
                   └ <agent.ReportAgent object at 0x000002889B13F0D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x000002889B0A22A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002889B6CFA50>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-01 22:03:22.735 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-01 22:03:22.736 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-01 22:03:22.737 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-01 22:03:53.118 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-01 22:03:53.120 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-01 22:03:53.120 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-01 22:03:53.120 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-01 22:03:53.121 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-01 22:03:53.121 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-01 22:03:53.122 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-01 22:03:53.122 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-01 22:03:53.123 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-01 22:03:53.123 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-01 22:03:53.124 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-01 22:03:55.230 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
2025-12-01 22:03:55.231 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000193B57BC9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000193B57BC0E0>
             └ <agent.ReportAgent object at 0x00000193B57AF090>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-01\n[PortfolioAgent]: Analyzed 6 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 6 stocks with total value ₹13,949.41. Overall P&L: ₹1,197.19 (+9.39%)', 'key_...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000193B57BC220>
                  └ <agent.ReportAgent object at 0x00000193B57AF090>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000193B57120C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000193B5D3AB50>
                   └ <agent.ReportAgent object at 0x00000193B57AF090>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000193B56F7560>
               │    └ <llms.base.LLMClient object at 0x00000193B59DDC10>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000193B5D3AB50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000193B56F6FC0>
                 └ <llms.base.LLMClient object at 0x00000193B59DDC10>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000193B60F7600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000193B39B9610>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000193B647FF50>
             │    └ <openai.OpenAI object at 0x00000193B57AD710>
             └ <llms.base.LLMClient object at 0x00000193B59DDC10>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000193B39B9610>,)
           └ <function Completions.create at 0x00000193B60F7420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000193B57AD710>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000193B39B9610>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000193B45B45E0>
           │    │          └ <openai.OpenAI object at 0x00000193B57AD710>
           │    └ ~ResponseT
           └ <function cast at 0x00000193B08A4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000193B45AED40>
          └ <openai.OpenAI object at 0x00000193B57AD710>

openai.PermissionDeniedError: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
2025-12-01 22:03:55.266 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-01 22:03:55.267 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000193B56F7560>
               │    └ <llms.base.LLMClient object at 0x00000193B59DDC10>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000193B5D3AB50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000193B56F6FC0>
                 └ <llms.base.LLMClient object at 0x00000193B59DDC10>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000193B60F7600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000193B39B9610>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000193B647FF50>
             │    └ <openai.OpenAI object at 0x00000193B57AD710>
             └ <llms.base.LLMClient object at 0x00000193B59DDC10>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000193B39B9610>,)
           └ <function Completions.create at 0x00000193B60F7420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000193B57AD710>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000193B39B9610>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000193B45B45E0>
           │    │          └ <openai.OpenAI object at 0x00000193B57AD710>
           │    └ ~ResponseT
           └ <function cast at 0x00000193B08A4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000193B45AED40>
          └ <openai.OpenAI object at 0x00000193B57AD710>

openai.PermissionDeniedError: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000193B57BC9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000193B57BC0E0>
             └ <agent.ReportAgent object at 0x00000193B57AF090>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-01\n[PortfolioAgent]: Analyzed 6 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 6 stocks with total value ₹13,949.41. Overall P&L: ₹1,197.19 (+9.39%)', 'key_...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000193B57BC220>
                  └ <agent.ReportAgent object at 0x00000193B57AF090>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000193B57120C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000193B5D3AB50>
                   └ <agent.ReportAgent object at 0x00000193B57AF090>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x00000193B57122A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000193B5D3AB50>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-01 22:06:56.662 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-01 22:06:56.664 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-01 22:06:56.665 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-01 22:07:24.765 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-01 22:07:24.766 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-01 22:07:24.766 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-01 22:07:24.766 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-01 22:07:24.768 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-01 22:07:24.769 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-01 22:07:24.769 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-01 22:07:24.769 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-01 22:07:24.770 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-01 22:07:24.771 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-01 22:07:24.772 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-01 22:08:05.108 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 33624 字符
2025-12-01 22:08:05.109 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 33612 字符
2025-12-01 22:08:05.109 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-01 22:08:05.110 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-01 22:08:05.113 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251201_220805.html
2025-12-01 22:08:05.118 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251201_220805.json
2025-12-01 22:08:05.119 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 40.35 秒
2025-12-01 22:15:02.922 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-01 22:15:02.924 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-01 22:15:02.925 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-01 22:15:30.218 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-01 22:15:30.218 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-01 22:15:30.219 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-01 22:15:30.219 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-01 22:15:30.221 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-01 22:15:30.222 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-01 22:15:30.223 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-01 22:15:30.223 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-01 22:15:30.224 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-01 22:15:30.226 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-01 22:15:30.227 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-01 22:16:22.993 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 32883 字符
2025-12-01 22:16:22.994 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 32875 字符
2025-12-01 22:16:22.994 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-01 22:16:22.994 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-01 22:16:22.996 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251201_221622.html
2025-12-01 22:16:23.000 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251201_221622.json
2025-12-01 22:16:23.000 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 52.78 秒
2025-12-01 22:37:35.122 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-01 22:37:35.124 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-01 22:37:35.125 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-01 22:38:05.516 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-01 22:38:05.517 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-01 22:38:05.517 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-01 22:38:05.518 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-01 22:38:05.520 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-01 22:38:05.520 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-01 22:38:05.521 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-01 22:38:05.521 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-01 22:38:05.522 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-01 22:38:05.523 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-01 22:38:05.525 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-01 22:38:56.152 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 30465 字符
2025-12-01 22:38:56.152 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 30457 字符
2025-12-01 22:38:56.153 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-01 22:38:56.153 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-01 22:38:56.155 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251201_223856.html
2025-12-01 22:38:56.159 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251201_223856.json
2025-12-01 22:38:56.160 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 50.64 秒
2025-12-01 22:41:11.209 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-01 22:41:11.211 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-01 22:41:11.211 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-01 22:41:40.308 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-01 22:41:40.309 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-01 22:41:40.309 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-01 22:41:40.310 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-01 22:41:40.310 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-01 22:41:40.311 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-01 22:41:40.311 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-01 22:41:40.314 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-01 22:41:40.315 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-01 22:41:40.316 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-01 22:41:40.316 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-01 22:42:29.358 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 33379 字符
2025-12-01 22:42:29.359 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 33371 字符
2025-12-01 22:42:29.360 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-01 22:42:29.360 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-01 22:42:29.364 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251201_224229.html
2025-12-01 22:42:29.369 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251201_224229.json
2025-12-01 22:42:29.371 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 49.06 秒
2025-12-02 20:11:06.231 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-02 20:11:06.233 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-02 20:11:06.234 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-02 20:11:36.589 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-02 20:11:36.591 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-02 20:11:36.592 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-02 20:11:36.592 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-02 20:11:36.593 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-02 20:11:36.593 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-02 20:11:36.594 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-02 20:11:36.594 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-02 20:11:36.595 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-02 20:11:36.596 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-02 20:11:36.598 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-02 20:12:26.099 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 28281 字符
2025-12-02 20:12:26.099 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 28273 字符
2025-12-02 20:12:26.100 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-02 20:12:26.100 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-02 20:12:26.103 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251202_201226.html
2025-12-02 20:12:26.105 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251202_201226.json
2025-12-02 20:12:26.105 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 49.52 秒
2025-12-02 20:15:05.103 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-02 20:15:05.105 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-02 20:15:05.106 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-02 20:15:35.459 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹1,197.19
2025-12-02 20:15:35.460 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 247
2025-12-02 20:15:35.461 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-02 20:15:35.461 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-02 20:15:35.462 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-02 20:15:35.462 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-02 20:15:35.463 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-02 20:15:35.463 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-02 20:15:35.464 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-02 20:15:35.465 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-02 20:15:35.466 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-02 20:16:16.336 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 24165 字符
2025-12-02 20:16:16.337 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 24153 字符
2025-12-02 20:16:16.337 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-02 20:16:16.338 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-02 20:16:16.341 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251202_201616.html
2025-12-02 20:16:16.343 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251202_201616.json
2025-12-02 20:16:16.344 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 40.88 秒
2025-12-03 21:47:16.339 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 21:47:16.341 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 21:47:16.342 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 21:47:35.871 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 21:47:35.872 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 21:47:35.873 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 21:49:00.869 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 21:49:00.871 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 21:49:00.871 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:00:56.771 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:00:56.773 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:00:56.773 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:03:22.175 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:03:22.177 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:03:22.177 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:15:30.392 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:15:30.394 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:15:30.395 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:29:45.625 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:29:45.626 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:29:45.627 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:32:57.464 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:32:57.466 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:32:57.466 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:36:12.347 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:36:12.349 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:36:12.349 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:37:45.598 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:37:45.600 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:37:45.601 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:40:35.938 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:40:35.940 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:40:35.941 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:42:22.350 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:42:22.350 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:42:22.352 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:47:28.687 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:47:28.689 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:47:28.689 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:53:56.408 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:53:56.409 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:53:56.410 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:54:57.926 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:54:57.927 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:54:57.928 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 22:58:36.657 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 22:58:36.657 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 22:58:36.658 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:00:23.904 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:00:23.905 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:00:23.905 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:04:55.886 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:04:55.887 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:04:55.887 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:08:50.948 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:08:50.949 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:08:50.949 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:09:15.398 | INFO     | agent:generate_report:197 - 开始生成报告: You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for darshanjain15062002@gmail.com.

PORTFOLIO SNAPSHOT:
• Total Value: ₹13,949.41
• Total P&L: ₹1,197.19 (+9.39%)
• Holdings: 6 stocks
• Date: 03-Dec-2025

YOUR MISSION: Generate a professional, beginner-friendly email report with SPECIFIC, ACTIONABLE recommendations.

CRITICAL REQUIREMENTS:
1. Every recommendation must have 3 clear reasons
2. Use simple Hindi-English mix ("Hinglish") tone for Indian investors
3. Quantify everything: "Book 50% profit" not "consider booking"
4. Mention exact prices and amounts in ₹
5. Explain WHY in simple terms

REPORT STRUCTURE:

## 📊 EXECUTIVE SUMMARY (3 sentences max)
Give overall health and 1 key action. Example: "Portfolio up 5.2%. ADANITOTALGAS needs profit booking. SBIN showing strength."

## 🎯 TODAY'S PRIORITY ACTIONS
Create this exact markdown table:

| Stock | My Advice | Why I'm Saying This | Urgency | Confidence |
|-------|-----------|---------------------|---------|------------|
| TATAMOTORS | ⏸️ **HOLD** | No triggers. Stock performing within expectations. | Medium term | **Medium** |
| ADANITOTALGAS | ⏸️ **HOLD** | No triggers. Stock performing within expectations. | Medium term | **Medium** |
| INFOSYS | ⏸️ **HOLD** | No triggers. Stock performing within expectations. | Medium term | **Medium** |
| SBIN | ⏳ **MONITOR** | Healthy profit of 15.2% - Consider booking 25-30% | **This Week** | **Medium** |
| TATASTEEL | ⏳ **MONITOR** | Healthy profit of 20.5% - Consider booking 25-30% | **This Week** | **Medium** |
| KALYANJEWL | 💰 **BOOK PROFIT** | Strong profit of 26.0% - Book 50-75% to lock gains | **TODAY** | **Medium** |

## 📈 EACH STOCK EXPLAINED SIMPLY

For EVERY holding, write:

### **[Stock Name] (₹avg_price → ₹current_price)**
Your Investment: ₹invested | Current Value: ₹current_value | **P&L: ₹pnl (pct%)**

**What Happened:** [Explain price movement in simple terms]

**My Verdict:** [Bullish/Neutral/Bearish]

**ACTION TO TAKE:** [Specific instruction: "Sell 50% of your 6 shares", "Hold all", "Exit completely"]

**3 Reasons Why:**
1. [Technical/fundamental reason]
2. [Risk/reward reason]  
3. [Market condition reason]

**Watch For:** [Price levels, news events]

## 🔄 REBALANCE IF NEEDED
- Overweight stocks? [Suggest trimming]
- Underweight opportunities? [Suggest adding]

## ⚠️ RISK CHECK
List 2-3 specific warnings with mitigation

## 💡 TODAY'S LEARNING
Explain one concept like "What is partial profit booking?" in 2 lines

## 📅 TOMORROW'S WATCHLIST
- Key price levels
- Important news/events

STOCK DATA TO ANALYZE:
{
  "portfolio_summary": {
    "total_invested": 12752.220000000001,
    "total_value": 13949.410000000002,
    "total_pnl": 1197.19,
    "total_pnl_percentage": 9.39,
    "best_performer": {
      "basic": {
        "symbol": "KALYANJEWL.NS",
        "name": "KALYANJEWL",
        "quantity": 2,
        "avg_price": 441.2,
        "current_price": 555.85,
        "pnl": 229.3,
        "pnl_percentage": 25.99,
        "weight_in_portfolio": 8.72,
        "total_invested": 882.4,
        "current_value": 1111.7
      },
      "performance_tier": "excellent",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "high",
          "message": "Strong profit of 26.0% - Book 50-75% to lock gains"
        }
      ]
    },
    "worst_performer": {
      "basic": {
        "symbol": "TATAMOTORS.NS",
        "name": "TATAMOTORS",
        "quantity": 6,
        "avg_price": 671.1,
        "current_price": 688.3000000000001,
        "pnl": 103.2,
        "pnl_percentage": 2.56,
        "weight_in_portfolio": 32.38,
        "total_invested": 4026.6,
        "current_value": 4129.8
      },
      "performance_tier": "moderate",
      "technical_signals": [
        {
          "source": "Yahoo Finance India",
          "reliability": 0.88,
          "market": "INDIAN",
          "data": {
            "symbol": "TATAMOTORS.NS",
            "price": 405.85,
            "change": 0,
            "changePercent": "0.00%",
            "previousClose": 405.85,
            "open": null,
            "high": null,
            "low": null,
            "volume": null,
            "currency": "INR"
          }
        },
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": []
    },
    "risk_level": "Medium"
  },
  "holdings": [
    {
      "basic": {
        "symbol": "TATAMOTORS.NS",
        "name": "TATAMOTORS",
        "quantity": 6,
        "avg_price": 671.1,
        "current_price": 688.3000000000001,
        "pnl": 103.2,
        "pnl_percentage": 2.56,
        "weight_in_portfolio": 32.38,
        "total_invested": 4026.6,
        "current_value": 4129.8
      },
      "performance_tier": "moderate",
      "technical_signals": [
        {
          "source": "Yahoo Finance India",
          "reliability": 0.88,
          "market": "INDIAN",
          "data": {
            "symbol": "TATAMOTORS.NS",
            "price": 405.85,
            "change": 0,
            "changePercent": "0.00%",
            "previousClose": 405.85,
            "open": null,
            "high": null,
            "low": null,
            "volume": null,
            "currency": "INR"
          }
        },
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": []
    },
    {
      "basic": {
        "symbol": "ADANITOTALGAS.NS",
        "name": "ADANITOTALGAS",
        "quantity": 3,
        "avg_price": 645.9,
        "current_price": 675.75,
        "pnl": 89.55,
        "pnl_percentage": 4.62,
        "weight_in_portfolio": 15.9,
        "total_invested": 1937.7,
        "current_value": 2027.25
      },
      "performance_tier": "moderate",
      "technical_signals": [
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": []
    },
    {
      "basic": {
        "symbol": "INFOSYS.NS",
        "name": "INFOSYS",
        "quantity": 1,
        "avg_price": 1502.9,
        "current_price": 1601.8,
        "pnl": 98.9,
        "pnl_percentage": 6.58,
        "weight_in_portfolio": 12.56,
        "total_invested": 1502.9,
        "current_value": 1601.8
      },
      "performance_tier": "moderate",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": []
    },
    {
      "basic": {
        "symbol": "SBIN.NS",
        "name": "SBIN",
        "quantity": 6,
        "avg_price": 711.6700000000001,
        "current_price": 819.85,
        "pnl": 649.08,
        "pnl_percentage": 15.2,
        "weight_in_portfolio": 38.57,
        "total_invested": 4270.02,
        "current_value": 4919.1
      },
      "performance_tier": "good",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "medium",
          "message": "Healthy profit of 15.2% - Consider booking 25-30%"
        }
      ]
    },
    {
      "basic": {
        "symbol": "TATASTEEL.NS",
        "name": "TATASTEEL",
        "quantity": 1,
        "avg_price": 132.6,
        "current_price": 159.76,
        "pnl": 27.16,
        "pnl_percentage": 20.48,
        "weight_in_portfolio": 1.25,
        "total_invested": 132.6,
        "current_value": 159.76
      },
      "performance_tier": "excellent",
      "technical_signals": [
        {
          "source": "Yahoo Finance India",
          "reliability": 0.88,
          "market": "INDIAN",
          "data": {
            "symbol": "TATASTEEL.NS",
            "price": 166.92,
            "change": -0.8600000000000136,
            "changePercent": "-0.51%",
            "previousClose": 167.78,
            "open": 167.77999877929688,
            "high": 167.99000549316406,
            "low": 165,
            "volume": 18869811,
            "currency": "INR"
          }
        },
        {
          "source": "NSE India",
          "data": {
            "symbol": "TATASTEEL",
            "price": 166.85,
            "change": -0.9300000000000068,
            "changePercent": -0.5542972940755791,
            "high": 167.99,
            "low": 165
          },
          "reliability": 0.95,
          "market": "INDIAN"
        },
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "medium",
          "message": "Healthy profit of 20.5% - Consider booking 25-30%"
        }
      ]
    },
    {
      "basic": {
        "symbol": "KALYANJEWL.NS",
        "name": "KALYANJEWL",
        "quantity": 2,
        "avg_price": 441.2,
        "current_price": 555.85,
        "pnl": 229.3,
        "pnl_percentage": 25.99,
        "weight_in_portfolio": 8.72,
        "total_invested": 882.4,
        "current_value": 1111.7
      },
      "performance_tier": "excellent",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "high",
          "message": "Strong profit of 26.0% - Book 50-75% to lock gains"
        }
      ]
    }
  ],
  "market_breakdown": {
    "US": 0.5471,
    "INDIAN": 0.4529
  },
  "portfolio_bias": {}
}

RULES:
- Be DIRECT and SPECIFIC
- No jargon without explanation
- If data poor, say "Insufficient data"
- Use emojis for visual appeal
- Keep sentences short
- Focus on ACTION over analysis

Generate the complete report now:
2025-12-03 23:09:15.401 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 1, 论坛日志长度: 91
2025-12-03 23:09:15.402 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:09:15.402 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:09:15.403 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:09:15.403 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:09:15.403 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:09:15.403 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:09:15.404 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:09:15.404 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:09:15.404 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:09:17.122 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
2025-12-03 23:09:17.122 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 648, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000118BEA95120>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 574, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000118BEA94360>
             └ <agent.ReportAgent object at 0x00000118BECC8410>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ 'Portfolio report generation for darshanjain15062002@gmail.com on 2025-12-03 23:09:15.398310'
                  │    │                     │      └ [{'type': 'comprehensive_portfolio_analysis', 'data': {'portfolio_summary': {'total_invested': 12752.220000000001, 'total_val...
                  │    │                     └ 'You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for darshanjain150...
                  │    └ <function ReportAgent._generate_html_report at 0x00000118BEA944A0>
                  └ <agent.ReportAgent object at 0x00000118BECC8410>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': 'You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for dars...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000118BE9EE340>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000118BECF00D0>
                   └ <agent.ReportAgent object at 0x00000118BECC8410>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000118BE9EC040>
               │    └ <llms.base.LLMClient object at 0x00000118BEA7F290>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000118BECF00D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000118BE9D7380>
                 └ <llms.base.LLMClient object at 0x00000118BEA7F290>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000118BF3A7F60>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000118BEDA1990>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000118BECBB110>
             │    └ <openai.OpenAI object at 0x00000118BECE5BD0>
             └ <llms.base.LLMClient object at 0x00000118BEA7F290>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000118BEDA1990>,)
           └ <function Completions.create at 0x00000118BF3A7E20>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000118BECE5BD0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000118BEDA1990>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000118BD898860>
           │    │          └ <openai.OpenAI object at 0x00000118BECE5BD0>
           │    └ ~ResponseT
           └ <function cast at 0x00000118B9B7D260>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000118BD88AFC0>
          └ <openai.OpenAI object at 0x00000118BECE5BD0>

openai.PermissionDeniedError: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]
2025-12-03 23:09:17.271 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-03 23:09:17.272 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000118BE9EC040>
               │    └ <llms.base.LLMClient object at 0x00000118BEA7F290>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000118BECF00D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000118BE9D7380>
                 └ <llms.base.LLMClient object at 0x00000118BEA7F290>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000118BF3A7F60>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000118BEDA1990>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000118BECBB110>
             │    └ <openai.OpenAI object at 0x00000118BECE5BD0>
             └ <llms.base.LLMClient object at 0x00000118BEA7F290>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000118BEDA1990>,)
           └ <function Completions.create at 0x00000118BF3A7E20>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000118BECE5BD0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000118BEDA1990>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000118BD898860>
           │    │          └ <openai.OpenAI object at 0x00000118BECE5BD0>
           │    └ ~ResponseT
           └ <function cast at 0x00000118B9B7D260>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000118BD88AFC0>
          └ <openai.OpenAI object at 0x00000118BECE5BD0>

openai.PermissionDeniedError: Error code: 403 - [{'error': {'code': 403, 'message': 'Your API key was reported as leaked. Please use another API key.', 'status': 'PERMISSION_DENIED'}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 648, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000118BEA95120>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 574, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000118BEA94360>
             └ <agent.ReportAgent object at 0x00000118BECC8410>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ 'Portfolio report generation for darshanjain15062002@gmail.com on 2025-12-03 23:09:15.398310'
                  │    │                     │      └ [{'type': 'comprehensive_portfolio_analysis', 'data': {'portfolio_summary': {'total_invested': 12752.220000000001, 'total_val...
                  │    │                     └ 'You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for darshanjain150...
                  │    └ <function ReportAgent._generate_html_report at 0x00000118BEA944A0>
                  └ <agent.ReportAgent object at 0x00000118BECC8410>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': 'You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for dars...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000118BE9EE340>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000118BECF00D0>
                   └ <agent.ReportAgent object at 0x00000118BECC8410>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': 'You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for dars...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x00000118BE9EE520>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000118BECF00D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-03 23:10:33.558 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:10:33.560 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:10:33.560 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:11:00.799 | INFO     | agent:generate_report:197 - 开始生成报告: You are **Portfolio Advisor Pro**, an expert Indian stock market advisor writing a DAILY PORTFOLIO REPORT for darshanjain15062002@gmail.com.

PORTFOLIO SNAPSHOT:
• Total Value: ₹13,949.41
• Total P&L: ₹1,197.19 (+9.39%)
• Holdings: 6 stocks
• Date: 03-Dec-2025

YOUR MISSION: Generate a professional, beginner-friendly email report with SPECIFIC, ACTIONABLE recommendations.

CRITICAL REQUIREMENTS:
1. Every recommendation must have 3 clear reasons
2. Use simple Hindi-English mix ("Hinglish") tone for Indian investors
3. Quantify everything: "Book 50% profit" not "consider booking"
4. Mention exact prices and amounts in ₹
5. Explain WHY in simple terms

REPORT STRUCTURE:

## 📊 EXECUTIVE SUMMARY (3 sentences max)
Give overall health and 1 key action. Example: "Portfolio up 5.2%. ADANITOTALGAS needs profit booking. SBIN showing strength."

## 🎯 TODAY'S PRIORITY ACTIONS
Create this exact markdown table:

| Stock | My Advice | Why I'm Saying This | Urgency | Confidence |
|-------|-----------|---------------------|---------|------------|
| TATAMOTORS | ⏸️ **HOLD** | No triggers. Stock performing within expectations. | Medium term | **Medium** |
| ADANITOTALGAS | ⏸️ **HOLD** | No triggers. Stock performing within expectations. | Medium term | **Medium** |
| INFOSYS | ⏸️ **HOLD** | No triggers. Stock performing within expectations. | Medium term | **Medium** |
| SBIN | ⏳ **MONITOR** | Healthy profit of 15.2% - Consider booking 25-30% | **This Week** | **Medium** |
| TATASTEEL | ⏳ **MONITOR** | Healthy profit of 20.5% - Consider booking 25-30% | **This Week** | **Medium** |
| KALYANJEWL | 💰 **BOOK PROFIT** | Strong profit of 26.0% - Book 50-75% to lock gains | **TODAY** | **Medium** |

## 📈 EACH STOCK EXPLAINED SIMPLY

For EVERY holding, write:

### **[Stock Name] (₹avg_price → ₹current_price)**
Your Investment: ₹invested | Current Value: ₹current_value | **P&L: ₹pnl (pct%)**

**What Happened:** [Explain price movement in simple terms]

**My Verdict:** [Bullish/Neutral/Bearish]

**ACTION TO TAKE:** [Specific instruction: "Sell 50% of your 6 shares", "Hold all", "Exit completely"]

**3 Reasons Why:**
1. [Technical/fundamental reason]
2. [Risk/reward reason]  
3. [Market condition reason]

**Watch For:** [Price levels, news events]

## 🔄 REBALANCE IF NEEDED
- Overweight stocks? [Suggest trimming]
- Underweight opportunities? [Suggest adding]

## ⚠️ RISK CHECK
List 2-3 specific warnings with mitigation

## 💡 TODAY'S LEARNING
Explain one concept like "What is partial profit booking?" in 2 lines

## 📅 TOMORROW'S WATCHLIST
- Key price levels
- Important news/events

STOCK DATA TO ANALYZE:
{
  "portfolio_summary": {
    "total_invested": 12752.220000000001,
    "total_value": 13949.410000000002,
    "total_pnl": 1197.19,
    "total_pnl_percentage": 9.39,
    "best_performer": {
      "basic": {
        "symbol": "KALYANJEWL.NS",
        "name": "KALYANJEWL",
        "quantity": 2,
        "avg_price": 441.2,
        "current_price": 555.85,
        "pnl": 229.3,
        "pnl_percentage": 25.99,
        "weight_in_portfolio": 8.72,
        "total_invested": 882.4,
        "current_value": 1111.7
      },
      "performance_tier": "excellent",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "high",
          "message": "Strong profit of 26.0% - Book 50-75% to lock gains"
        }
      ]
    },
    "worst_performer": {
      "basic": {
        "symbol": "TATAMOTORS.NS",
        "name": "TATAMOTORS",
        "quantity": 6,
        "avg_price": 671.1,
        "current_price": 688.3000000000001,
        "pnl": 103.2,
        "pnl_percentage": 2.56,
        "weight_in_portfolio": 32.38,
        "total_invested": 4026.6,
        "current_value": 4129.8
      },
      "performance_tier": "moderate",
      "technical_signals": [
        {
          "source": "Yahoo Finance India",
          "reliability": 0.88,
          "market": "INDIAN",
          "data": {
            "symbol": "TATAMOTORS.NS",
            "price": 405.85,
            "change": 0,
            "changePercent": "0.00%",
            "previousClose": 405.85,
            "open": null,
            "high": null,
            "low": null,
            "volume": null,
            "currency": "INR"
          }
        },
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": []
    },
    "risk_level": "Medium"
  },
  "holdings": [
    {
      "basic": {
        "symbol": "TATAMOTORS.NS",
        "name": "TATAMOTORS",
        "quantity": 6,
        "avg_price": 671.1,
        "current_price": 688.3000000000001,
        "pnl": 103.2,
        "pnl_percentage": 2.56,
        "weight_in_portfolio": 32.38,
        "total_invested": 4026.6,
        "current_value": 4129.8
      },
      "performance_tier": "moderate",
      "technical_signals": [
        {
          "source": "Yahoo Finance India",
          "reliability": 0.88,
          "market": "INDIAN",
          "data": {
            "symbol": "TATAMOTORS.NS",
            "price": 405.85,
            "change": 0,
            "changePercent": "0.00%",
            "previousClose": 405.85,
            "open": null,
            "high": null,
            "low": null,
            "volume": null,
            "currency": "INR"
          }
        },
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": []
    },
    {
      "basic": {
        "symbol": "ADANITOTALGAS.NS",
        "name": "ADANITOTALGAS",
        "quantity": 3,
        "avg_price": 645.9,
        "current_price": 675.75,
        "pnl": 89.55,
        "pnl_percentage": 4.62,
        "weight_in_portfolio": 15.9,
        "total_invested": 1937.7,
        "current_value": 2027.25
      },
      "performance_tier": "moderate",
      "technical_signals": [
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": []
    },
    {
      "basic": {
        "symbol": "INFOSYS.NS",
        "name": "INFOSYS",
        "quantity": 1,
        "avg_price": 1502.9,
        "current_price": 1601.8,
        "pnl": 98.9,
        "pnl_percentage": 6.58,
        "weight_in_portfolio": 12.56,
        "total_invested": 1502.9,
        "current_value": 1601.8
      },
      "performance_tier": "moderate",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": []
    },
    {
      "basic": {
        "symbol": "SBIN.NS",
        "name": "SBIN",
        "quantity": 6,
        "avg_price": 711.6700000000001,
        "current_price": 819.85,
        "pnl": 649.08,
        "pnl_percentage": 15.2,
        "weight_in_portfolio": 38.57,
        "total_invested": 4270.02,
        "current_value": 4919.1
      },
      "performance_tier": "good",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "medium",
          "message": "Healthy profit of 15.2% - Consider booking 25-30%"
        }
      ]
    },
    {
      "basic": {
        "symbol": "TATASTEEL.NS",
        "name": "TATASTEEL",
        "quantity": 1,
        "avg_price": 132.6,
        "current_price": 159.76,
        "pnl": 27.16,
        "pnl_percentage": 20.48,
        "weight_in_portfolio": 1.25,
        "total_invested": 132.6,
        "current_value": 159.76
      },
      "performance_tier": "excellent",
      "technical_signals": [
        {
          "source": "Yahoo Finance India",
          "reliability": 0.88,
          "market": "INDIAN",
          "data": {
            "symbol": "TATASTEEL.NS",
            "price": 166.92,
            "change": -0.8600000000000136,
            "changePercent": "-0.51%",
            "previousClose": 167.78,
            "open": 167.77999877929688,
            "high": 167.99000549316406,
            "low": 165,
            "volume": 18869811,
            "currency": "INR"
          }
        },
        {
          "source": "NSE India",
          "data": {
            "symbol": "TATASTEEL",
            "price": 166.85,
            "change": -0.9300000000000068,
            "changePercent": -0.5542972940755791,
            "high": 167.99,
            "low": 165
          },
          "reliability": 0.95,
          "market": "INDIAN"
        },
        {
          "source": "AlphaVantage India",
          "data": {},
          "reliability": 0.8,
          "market": "INDIAN"
        }
      ],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "medium",
          "message": "Healthy profit of 20.5% - Consider booking 25-30%"
        }
      ]
    },
    {
      "basic": {
        "symbol": "KALYANJEWL.NS",
        "name": "KALYANJEWL",
        "quantity": 2,
        "avg_price": 441.2,
        "current_price": 555.85,
        "pnl": 229.3,
        "pnl_percentage": 25.99,
        "weight_in_portfolio": 8.72,
        "total_invested": 882.4,
        "current_value": 1111.7
      },
      "performance_tier": "excellent",
      "technical_signals": [],
      "bias_score": {},
      "action_triggers": [
        {
          "type": "profit_target",
          "severity": "high",
          "message": "Strong profit of 26.0% - Book 50-75% to lock gains"
        }
      ]
    }
  ],
  "market_breakdown": {
    "US": 0.5471,
    "INDIAN": 0.4529
  },
  "portfolio_bias": {}
}

RULES:
- Be DIRECT and SPECIFIC
- No jargon without explanation
- If data poor, say "Insufficient data"
- Use emojis for visual appeal
- Keep sentences short
- Focus on ACTION over analysis

Generate the complete report now:
2025-12-03 23:11:00.802 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 1, 论坛日志长度: 91
2025-12-03 23:11:00.803 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:11:00.803 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:11:00.804 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:11:00.804 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:11:00.804 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:11:00.805 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:11:00.805 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:11:00.805 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:11:00.806 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:11:50.379 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 25690 字符
2025-12-03 23:11:50.380 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 25682 字符
2025-12-03 23:11:50.380 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-03 23:11:50.382 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-03 23:11:50.382 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251203_231150.html
2025-12-03 23:11:50.383 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251203_231150.json
2025-12-03 23:11:50.383 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 49.58 秒
2025-12-03 23:40:11.433 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:40:11.434 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:40:11.436 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:40:15.512 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-03 23:40:15.512 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-03 23:40:15.513 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:40:15.514 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:40:15.514 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:40:15.515 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:40:15.515 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:40:15.516 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:40:15.516 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:40:15.517 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:40:15.518 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:41:00.500 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 33544 字符
2025-12-03 23:41:00.500 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 33527 字符
2025-12-03 23:41:00.501 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-03 23:41:00.501 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-03 23:41:00.504 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251203_234100.html
2025-12-03 23:41:00.522 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251203_234100.json
2025-12-03 23:41:00.523 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 45.01 秒
2025-12-03 23:44:49.948 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:44:49.950 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:44:49.950 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:44:54.007 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-03 23:44:54.008 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-03 23:44:54.009 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:44:54.009 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:44:54.010 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:44:54.011 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:44:54.011 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:44:54.012 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:44:54.012 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:44:54.013 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:44:54.015 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:45:43.340 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 27778 字符
2025-12-03 23:45:43.341 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 27766 字符
2025-12-03 23:45:43.343 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-03 23:45:43.343 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-03 23:45:43.345 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251203_234543.html
2025-12-03 23:45:43.348 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251203_234543.json
2025-12-03 23:45:43.351 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 49.34 秒
2025-12-03 23:51:25.730 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:51:25.732 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:51:25.732 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:51:29.826 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-03 23:51:29.827 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-03 23:51:29.827 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:51:29.828 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:51:29.829 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:51:29.829 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:51:29.830 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:51:29.830 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:51:29.832 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:51:29.832 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:51:29.833 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:51:58.544 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 21060 字符
2025-12-03 23:51:58.545 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 21048 字符
2025-12-03 23:51:58.545 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-03 23:51:58.546 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-03 23:51:58.548 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251203_235158.html
2025-12-03 23:51:58.550 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251203_235158.json
2025-12-03 23:51:58.550 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 28.72 秒
2025-12-03 23:53:53.805 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:53:53.806 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:53:53.807 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:54:02.653 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-03 23:54:02.669 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-03 23:54:02.671 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:54:02.671 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:54:02.673 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:54:02.674 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:54:02.675 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:54:02.676 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:54:02.676 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:54:02.677 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:54:02.677 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:54:53.144 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 35432 字符
2025-12-03 23:54:53.144 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 35420 字符
2025-12-03 23:54:53.145 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-03 23:54:53.145 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-03 23:54:53.148 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251203_235453.html
2025-12-03 23:54:53.150 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251203_235453.json
2025-12-03 23:54:53.151 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 50.50 秒
2025-12-03 23:56:38.476 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-03 23:56:38.478 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-03 23:56:38.479 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-03 23:57:03.243 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-03 23:57:03.243 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-03 23:57:03.244 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-03 23:57:03.245 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-03 23:57:03.246 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-03 23:57:03.246 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-03 23:57:03.247 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-03 23:57:03.247 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-03 23:57:03.250 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-03 23:57:03.251 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-03 23:57:03.254 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-03 23:57:48.046 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 28307 字符
2025-12-03 23:57:48.047 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 28295 字符
2025-12-03 23:57:48.048 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-03 23:57:48.048 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-03 23:57:48.050 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251203_235748.html
2025-12-03 23:57:48.054 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251203_235748.json
2025-12-03 23:57:48.055 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 44.81 秒
2025-12-04 20:32:12.201 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 20:32:12.204 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 20:32:12.205 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 20:32:18.636 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 20:32:18.638 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 20:32:18.639 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 20:32:18.640 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 20:32:18.642 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 20:32:18.643 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 20:32:18.644 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 20:32:18.646 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 20:32:18.647 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 20:32:18.648 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 20:32:18.648 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 20:33:06.601 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 26603 字符
2025-12-04 20:33:06.602 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 26591 字符
2025-12-04 20:33:06.602 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 20:33:06.603 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 20:33:06.606 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_203306.html
2025-12-04 20:33:06.612 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_203306.json
2025-12-04 20:33:06.614 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 47.98 秒
2025-12-04 20:38:48.574 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 20:38:48.576 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 20:38:48.577 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 20:38:54.174 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 20:38:54.176 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 20:38:54.177 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 20:38:54.177 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 20:38:54.179 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 20:38:54.180 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 20:38:54.181 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 20:38:54.182 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 20:38:54.182 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 20:38:54.183 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 20:38:54.184 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 20:39:33.660 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 24479 字符
2025-12-04 20:39:33.661 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 24467 字符
2025-12-04 20:39:33.661 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 20:39:33.661 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 20:39:33.664 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_203933.html
2025-12-04 20:39:33.668 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_203933.json
2025-12-04 20:39:33.669 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 39.49 秒
2025-12-04 20:43:47.279 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 20:43:47.281 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 20:43:47.282 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 20:43:52.985 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 20:43:52.988 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 20:43:52.989 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 20:43:52.991 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 20:43:52.993 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 20:43:52.994 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 20:43:52.997 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 20:43:52.999 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 20:43:53.000 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 20:43:53.001 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 20:43:53.001 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 20:44:36.365 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 28638 字符
2025-12-04 20:44:36.366 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 28626 字符
2025-12-04 20:44:36.367 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 20:44:36.368 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 20:44:36.372 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_204436.html
2025-12-04 20:44:36.375 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_204436.json
2025-12-04 20:44:36.376 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 43.39 秒
2025-12-04 20:45:59.061 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 20:45:59.063 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 20:45:59.063 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 20:46:22.391 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 20:46:22.393 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 20:46:22.395 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 20:46:22.396 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 20:46:22.398 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 20:46:22.401 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 20:46:22.403 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 20:46:22.405 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 20:46:22.406 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 20:46:22.407 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 20:46:22.408 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 20:47:16.240 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 29179 字符
2025-12-04 20:47:16.241 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 29167 字符
2025-12-04 20:47:16.241 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 20:47:16.242 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 20:47:16.245 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_204716.html
2025-12-04 20:47:16.248 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_204716.json
2025-12-04 20:47:16.253 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 53.86 秒
2025-12-04 21:04:58.407 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 21:04:58.409 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 21:04:58.410 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 21:05:02.491 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 21:05:02.492 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 21:05:02.493 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 21:05:02.493 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 21:05:02.494 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 21:05:02.495 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 21:05:02.496 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 21:05:02.498 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 21:05:02.499 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 21:05:02.501 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 21:05:02.502 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 21:06:10.588 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 21:06:10.590 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 21:06:10.590 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 21:06:12.877 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 21:06:12.878 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 21:06:12.878 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 21:06:12.879 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 21:06:12.880 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 21:06:12.881 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 21:06:12.881 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 21:06:12.882 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 21:06:12.883 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 21:06:12.884 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 21:06:12.885 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 21:06:32.961 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 9529 字符
2025-12-04 21:06:32.962 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 9521 字符
2025-12-04 21:06:32.962 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 21:06:32.962 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 21:06:32.964 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_210632.html
2025-12-04 21:06:32.967 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_210632.json
2025-12-04 21:06:32.968 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 20.09 秒
2025-12-04 21:08:40.018 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 21:08:40.019 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 21:08:40.020 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 21:08:42.605 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 21:08:42.607 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 21:08:42.608 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 21:08:42.608 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 21:08:42.609 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 21:08:42.610 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 21:08:42.611 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 21:08:42.611 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 21:08:42.611 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 21:08:42.612 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 21:08:42.613 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 21:09:23.333 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 19716 字符
2025-12-04 21:09:23.333 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 19704 字符
2025-12-04 21:09:23.334 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 21:09:23.335 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 21:09:23.337 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_210923.html
2025-12-04 21:09:23.340 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_210923.json
2025-12-04 21:09:23.341 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 40.74 秒
2025-12-04 23:14:53.264 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:14:53.268 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:14:53.268 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:14:53.369 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:14:53.370 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:14:53.370 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:14:53.371 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:14:53.372 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:14:53.372 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:14:53.373 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:14:53.373 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:14:53.374 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:14:53.375 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:14:53.375 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:15:49.871 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:15:49.873 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:15:49.873 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:15:49.942 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:15:49.943 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:15:49.943 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:15:49.944 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:15:49.945 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:15:49.946 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:15:49.946 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:15:49.948 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:15:49.949 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:15:49.950 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:15:49.951 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:26:05.637 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:26:05.639 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:26:05.640 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:26:05.743 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:26:05.744 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:26:05.745 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:26:05.746 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:26:05.747 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:26:05.748 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:26:05.749 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:26:05.750 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:26:05.751 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:26:05.751 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:26:05.753 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:27:11.080 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:27:11.082 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:27:11.082 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:27:18.078 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:27:18.081 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:27:18.083 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:27:18.084 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:27:18.085 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:27:18.086 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:27:18.087 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:27:18.087 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:27:18.088 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:27:18.088 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:27:18.089 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:28:01.462 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 22487 字符
2025-12-04 23:28:01.465 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 22475 字符
2025-12-04 23:28:01.465 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 23:28:01.467 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 23:28:01.470 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_232801.html
2025-12-04 23:28:01.473 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_232801.json
2025-12-04 23:28:01.473 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 43.39 秒
2025-12-04 23:28:46.719 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:28:46.720 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:28:46.721 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:28:58.892 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:28:58.893 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:28:58.894 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:28:58.895 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:28:58.897 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:28:58.898 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:28:58.899 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:28:58.900 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:28:58.901 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:28:58.902 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:28:58.903 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:29:56.539 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:29:56.541 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:29:56.542 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:30:18.629 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:30:18.630 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:30:18.631 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:30:18.632 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:30:18.632 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:30:18.633 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:30:18.633 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:30:18.635 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:30:18.635 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:30:18.636 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:30:18.637 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:30:50.307 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:30:50.309 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:30:50.310 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:31:05.471 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:31:05.472 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:31:05.473 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:31:05.474 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:31:05.475 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:31:05.477 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:31:05.478 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:31:05.479 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:31:05.479 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:31:05.480 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:31:05.481 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:31:44.008 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 24264 字符
2025-12-04 23:31:44.009 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 24252 字符
2025-12-04 23:31:44.010 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 23:31:44.010 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 23:31:44.013 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_233144.html
2025-12-04 23:31:44.016 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_233144.json
2025-12-04 23:31:44.040 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 38.57 秒
2025-12-04 23:32:53.178 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:32:53.183 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:32:53.184 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:33:08.547 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:33:08.548 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:33:08.549 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:33:08.551 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:33:08.553 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:33:08.554 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:33:08.555 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:33:08.556 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:33:08.557 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:33:08.557 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:33:08.558 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:33:54.876 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 30698 字符
2025-12-04 23:33:54.877 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 30665 字符
2025-12-04 23:33:54.877 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 23:33:54.878 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 23:33:54.904 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_233354.html
2025-12-04 23:33:54.907 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_233354.json
2025-12-04 23:33:54.909 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 46.36 秒
2025-12-04 23:36:06.209 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-04 23:36:06.211 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-04 23:36:06.212 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-04 23:36:27.265 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-04 23:36:27.267 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-04 23:36:27.270 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-04 23:36:27.270 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-04 23:36:27.272 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-04 23:36:27.272 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-04 23:36:27.272 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-04 23:36:27.273 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-04 23:36:27.273 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-04 23:36:27.273 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-04 23:36:27.273 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-04 23:37:09.251 | INFO     | nodes.html_generation_node:process_output:108 - 处理LLM原始输出，长度: 25533 字符
2025-12-04 23:37:09.252 | INFO     | nodes.html_generation_node:process_output:127 - HTML处理完成，最终长度: 25521 字符
2025-12-04 23:37:09.252 | INFO     | nodes.html_generation_node:run:68 - HTML报告生成完成
2025-12-04 23:37:09.252 | INFO     | agent:_generate_html_report:294 - HTML报告生成完成
2025-12-04 23:37:09.254 | INFO     | agent:_save_report:360 - 报告已保存到: final_reports\final_report__20251204_233709.html
2025-12-04 23:37:09.256 | INFO     | agent:_save_report:366 - 状态已保存到: final_reports\report_state__20251204_233709.json
2025-12-04 23:37:09.257 | INFO     | agent:generate_report:216 - 报告生成完成，耗时: 41.99 秒
2025-12-07 18:39:38.715 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 18:39:38.717 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 18:39:38.717 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 18:39:46.801 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 18:39:46.801 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 18:39:46.801 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 18:39:46.802 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 18:39:46.802 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 18:39:46.803 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 18:39:46.803 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 18:39:46.804 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 18:39:46.805 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 18:39:46.805 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 18:39:46.806 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 18:39:48.841 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 9.775738543s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '9s'}]}}]
2025-12-07 18:39:48.843 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 9.775738543s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '9s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000028905EEC9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000028905EEC0E0>
             └ <agent.ReportAgent object at 0x000002890742C050>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000028905EEC220>
                  └ <agent.ReportAgent object at 0x000002890742C050>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000028905E420C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002890743A790>
                   └ <agent.ReportAgent object at 0x000002890742C050>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000028905E2B560>
               │    └ <llms.base.LLMClient object at 0x00000289070DFF10>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002890743A790>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000028905E2AFC0>
                 └ <llms.base.LLMClient object at 0x00000289070DFF10>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000289077B7560>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000289074EB850>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000028907A645D0>
             │    └ <openai.OpenAI object at 0x000002890743BBD0>
             └ <llms.base.LLMClient object at 0x00000289070DFF10>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000289074EB850>,)
           └ <function Completions.create at 0x00000289077B7380>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002890743BBD0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000289074EB850>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000028905CB45E0>
           │    │          └ <openai.OpenAI object at 0x000002890743BBD0>
           │    └ ~ResponseT
           └ <function cast at 0x0000028901F54FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000028905CAED40>
          └ <openai.OpenAI object at 0x000002890743BBD0>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 9.775738543s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '9s'}]}}]
2025-12-07 18:39:49.140 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 18:39:49.141 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000028905E2B560>
               │    └ <llms.base.LLMClient object at 0x00000289070DFF10>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002890743A790>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000028905E2AFC0>
                 └ <llms.base.LLMClient object at 0x00000289070DFF10>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000289077B7560>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000289074EB850>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000028907A645D0>
             │    └ <openai.OpenAI object at 0x000002890743BBD0>
             └ <llms.base.LLMClient object at 0x00000289070DFF10>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000289074EB850>,)
           └ <function Completions.create at 0x00000289077B7380>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002890743BBD0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000289074EB850>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000028905CB45E0>
           │    │          └ <openai.OpenAI object at 0x000002890743BBD0>
           │    └ ~ResponseT
           └ <function cast at 0x0000028901F54FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000028905CAED40>
          └ <openai.OpenAI object at 0x000002890743BBD0>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 9.775738543s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '9s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000028905EEC9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000028905EEC0E0>
             └ <agent.ReportAgent object at 0x000002890742C050>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000028905EEC220>
                  └ <agent.ReportAgent object at 0x000002890742C050>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000028905E420C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002890743A790>
                   └ <agent.ReportAgent object at 0x000002890742C050>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x0000028905E422A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002890743A790>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 18:40:30.629 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 18:40:30.632 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 18:40:30.632 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 18:40:44.175 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 18:40:44.176 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 18:40:44.178 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 18:40:44.180 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 18:40:44.180 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 18:40:44.182 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 18:40:44.183 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 18:40:44.186 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 18:40:44.187 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 18:40:44.188 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 18:40:44.190 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 18:40:45.889 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 12.703493765s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '12s'}]}}]
2025-12-07 18:40:45.890 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 12.703493765s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '12s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000015F1910C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000015F1910C0E0>
             └ <agent.ReportAgent object at 0x0000015F1A6530D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000015F1910C220>
                  └ <agent.ReportAgent object at 0x0000015F1A6530D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000015F190620C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000015F1A660810>
                   └ <agent.ReportAgent object at 0x0000015F1A6530D0>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000015F1904B560>
               │    └ <llms.base.LLMClient object at 0x0000015F1A2FE990>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000015F1A660810>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000015F1904AFC0>
                 └ <llms.base.LLMClient object at 0x0000015F1A2FE990>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x0000015F1A93B600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000015F1A709710>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000015F1A2FE8D0>
             │    └ <openai.OpenAI object at 0x0000015F190FD090>
             └ <llms.base.LLMClient object at 0x0000015F1A2FE990>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000015F1A709710>,)
           └ <function Completions.create at 0x0000015F1A93B420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000015F190FD090>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000015F1A709710>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000015F18ED45E0>
           │    │          └ <openai.OpenAI object at 0x0000015F190FD090>
           │    └ ~ResponseT
           └ <function cast at 0x0000015F151E4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000015F18ECED40>
          └ <openai.OpenAI object at 0x0000015F190FD090>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 12.703493765s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '12s'}]}}]
2025-12-07 18:40:46.145 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 18:40:46.147 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000015F1904B560>
               │    └ <llms.base.LLMClient object at 0x0000015F1A2FE990>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000015F1A660810>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000015F1904AFC0>
                 └ <llms.base.LLMClient object at 0x0000015F1A2FE990>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x0000015F1A93B600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000015F1A709710>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000015F1A2FE8D0>
             │    └ <openai.OpenAI object at 0x0000015F190FD090>
             └ <llms.base.LLMClient object at 0x0000015F1A2FE990>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000015F1A709710>,)
           └ <function Completions.create at 0x0000015F1A93B420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000015F190FD090>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000015F1A709710>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000015F18ED45E0>
           │    │          └ <openai.OpenAI object at 0x0000015F190FD090>
           │    └ ~ResponseT
           └ <function cast at 0x0000015F151E4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000015F18ECED40>
          └ <openai.OpenAI object at 0x0000015F190FD090>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 12.703493765s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '12s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 382, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000015F1910C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 312, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000015F1910C0E0>
             └ <agent.ReportAgent object at 0x0000015F1A6530D0>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000015F1910C220>
                  └ <agent.ReportAgent object at 0x0000015F1A6530D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000015F190620C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000015F1A660810>
                   └ <agent.ReportAgent object at 0x0000015F1A6530D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x0000015F190622A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000015F1A660810>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 18:54:38.825 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 18:54:38.827 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 18:54:38.827 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 18:54:49.531 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 18:54:49.532 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 18:54:49.533 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 18:54:49.534 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 18:54:49.534 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 18:54:49.535 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 18:54:49.535 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 18:54:49.536 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 18:54:49.536 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 18:54:49.537 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 18:54:49.540 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 18:54:50.950 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 7.743378136s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '7s'}]}}]
2025-12-07 18:54:50.951 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 7.743378136s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '7s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x000001A527D2C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x000001A527D2C0E0>
             └ <agent.ReportAgent object at 0x000001A529260710>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x000001A527D2C220>
                  └ <agent.ReportAgent object at 0x000001A529260710>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x000001A527C820C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001A529280450>
                   └ <agent.ReportAgent object at 0x000001A529260710>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x000001A527C6B560>
               │    └ <llms.base.LLMClient object at 0x000001A527D1C350>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001A529280450>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x000001A527C6AFC0>
                 └ <llms.base.LLMClient object at 0x000001A527D1C350>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x000001A52954B7E0>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001A529329650>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x000001A527D1EA90>
             │    └ <openai.OpenAI object at 0x000001A52927DDD0>
             └ <llms.base.LLMClient object at 0x000001A527D1C350>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001A529329650>,)
           └ <function Completions.create at 0x000001A52954B600>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001A52927DDD0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001A529329650>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001A527AF45E0>
           │    │          └ <openai.OpenAI object at 0x000001A52927DDD0>
           │    └ ~ResponseT
           └ <function cast at 0x000001A523D74FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001A527AEED40>
          └ <openai.OpenAI object at 0x000001A52927DDD0>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 7.743378136s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '7s'}]}}]
2025-12-07 18:54:50.982 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 18:54:50.984 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x000001A527C6B560>
               │    └ <llms.base.LLMClient object at 0x000001A527D1C350>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001A529280450>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x000001A527C6AFC0>
                 └ <llms.base.LLMClient object at 0x000001A527D1C350>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x000001A52954B7E0>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001A529329650>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x000001A527D1EA90>
             │    └ <openai.OpenAI object at 0x000001A52927DDD0>
             └ <llms.base.LLMClient object at 0x000001A527D1C350>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001A529329650>,)
           └ <function Completions.create at 0x000001A52954B600>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001A52927DDD0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001A529329650>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001A527AF45E0>
           │    │          └ <openai.OpenAI object at 0x000001A52927DDD0>
           │    └ ~ResponseT
           └ <function cast at 0x000001A523D74FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001A527AEED40>
          └ <openai.OpenAI object at 0x000001A52927DDD0>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 7.743378136s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '7s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x000001A527D2C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x000001A527D2C0E0>
             └ <agent.ReportAgent object at 0x000001A529260710>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x000001A527D2C220>
                  └ <agent.ReportAgent object at 0x000001A529260710>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x000001A527C820C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001A529280450>
                   └ <agent.ReportAgent object at 0x000001A529260710>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x000001A527C822A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001A529280450>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 18:57:15.145 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 18:57:15.146 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 18:57:15.147 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 18:57:15.712 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 18:57:15.713 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 18:57:15.714 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 18:57:15.714 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 18:57:15.715 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 18:57:15.716 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 18:57:15.717 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 18:57:15.717 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 18:57:15.718 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 18:57:15.719 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 18:57:15.720 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 18:57:17.135 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 41.62704292s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '41s'}]}}]
2025-12-07 18:57:17.136 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 41.62704292s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '41s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000029A1BC1C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000029A1BC1C0E0>
             └ <agent.ReportAgent object at 0x0000029A1C18B750>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000029A1BC1C220>
                  └ <agent.ReportAgent object at 0x0000029A1C18B750>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000029A1BB720C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000029A1C19A9D0>
                   └ <agent.ReportAgent object at 0x0000029A1C18B750>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000029A1BB5B560>
               │    └ <llms.base.LLMClient object at 0x0000029A1BE3DED0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000029A1C19A9D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000029A1BB5AFC0>
                 └ <llms.base.LLMClient object at 0x0000029A1BE3DED0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x0000029A1C4DF600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000029A1C246090>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000029A1C246990>
             │    └ <openai.OpenAI object at 0x0000029A1BC0D950>
             └ <llms.base.LLMClient object at 0x0000029A1BE3DED0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000029A1C246090>,)
           └ <function Completions.create at 0x0000029A1C4DF420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000029A1BC0D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000029A1C246090>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000029A1AA145E0>
           │    │          └ <openai.OpenAI object at 0x0000029A1BC0D950>
           │    └ ~ResponseT
           └ <function cast at 0x0000029A16C84FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000029A1AA0ED40>
          └ <openai.OpenAI object at 0x0000029A1BC0D950>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 41.62704292s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '41s'}]}}]
2025-12-07 18:57:17.162 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 18:57:17.163 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000029A1BB5B560>
               │    └ <llms.base.LLMClient object at 0x0000029A1BE3DED0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000029A1C19A9D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000029A1BB5AFC0>
                 └ <llms.base.LLMClient object at 0x0000029A1BE3DED0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x0000029A1C4DF600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000029A1C246090>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000029A1C246990>
             │    └ <openai.OpenAI object at 0x0000029A1BC0D950>
             └ <llms.base.LLMClient object at 0x0000029A1BE3DED0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000029A1C246090>,)
           └ <function Completions.create at 0x0000029A1C4DF420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000029A1BC0D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000029A1C246090>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000029A1AA145E0>
           │    │          └ <openai.OpenAI object at 0x0000029A1BC0D950>
           │    └ ~ResponseT
           └ <function cast at 0x0000029A16C84FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000029A1AA0ED40>
          └ <openai.OpenAI object at 0x0000029A1BC0D950>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 41.62704292s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '41s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000029A1BC1C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000029A1BC1C0E0>
             └ <agent.ReportAgent object at 0x0000029A1C18B750>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000029A1BC1C220>
                  └ <agent.ReportAgent object at 0x0000029A1C18B750>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000029A1BB720C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000029A1C19A9D0>
                   └ <agent.ReportAgent object at 0x0000029A1C18B750>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x0000029A1BB722A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000029A1C19A9D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 18:57:57.214 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 18:57:57.216 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 18:57:57.216 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 18:57:57.242 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 18:57:57.242 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 18:57:57.243 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 18:57:57.243 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 18:57:57.243 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 18:57:57.245 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 18:57:57.245 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 18:57:57.245 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 18:57:57.246 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 18:57:57.246 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 18:57:57.246 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 18:57:58.532 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 400 - [{'error': {'code': 400, 'message': 'API key expired. Please renew the API key.', 'status': 'INVALID_ARGUMENT', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'API_KEY_INVALID', 'domain': 'googleapis.com', 'metadata': {'service': 'generativelanguage.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'API key expired. Please renew the API key.'}]}}]
2025-12-07 18:57:58.533 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 400 - [{'error': {'code': 400, 'message': 'API key expired. Please renew the API key.', 'status': 'INVALID_ARGUMENT', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'API_KEY_INVALID', 'domain': 'googleapis.com', 'metadata': {'service': 'generativelanguage.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'API key expired. Please renew the API key.'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000024967E0C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000024967E0C0E0>
             └ <agent.ReportAgent object at 0x0000024967DFF310>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000024967E0C220>
                  └ <agent.ReportAgent object at 0x0000024967DFF310>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000024967D620C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002496935C8D0>
                   └ <agent.ReportAgent object at 0x0000024967DFF310>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000024967D4B560>
               │    └ <llms.base.LLMClient object at 0x0000024968FFDF90>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002496935C8D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000024967D4AFC0>
                 └ <llms.base.LLMClient object at 0x0000024968FFDF90>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000249696EF600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000024969409F10>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000024969409F90>
             │    └ <openai.OpenAI object at 0x0000024967DFD950>
             └ <llms.base.LLMClient object at 0x0000024968FFDF90>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000024969409F10>,)
           └ <function Completions.create at 0x00000249696EF420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000024967DFD950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000024969409F10>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000024967BD45E0>
           │    │          └ <openai.OpenAI object at 0x0000024967DFD950>
           │    └ ~ResponseT
           └ <function cast at 0x0000024963F44FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000024967BCED40>
          └ <openai.OpenAI object at 0x0000024967DFD950>

openai.BadRequestError: Error code: 400 - [{'error': {'code': 400, 'message': 'API key expired. Please renew the API key.', 'status': 'INVALID_ARGUMENT', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'API_KEY_INVALID', 'domain': 'googleapis.com', 'metadata': {'service': 'generativelanguage.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'API key expired. Please renew the API key.'}]}}]
2025-12-07 18:57:58.607 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 18:57:58.608 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000024967D4B560>
               │    └ <llms.base.LLMClient object at 0x0000024968FFDF90>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002496935C8D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000024967D4AFC0>
                 └ <llms.base.LLMClient object at 0x0000024968FFDF90>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000249696EF600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000024969409F10>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000024969409F90>
             │    └ <openai.OpenAI object at 0x0000024967DFD950>
             └ <llms.base.LLMClient object at 0x0000024968FFDF90>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000024969409F10>,)
           └ <function Completions.create at 0x00000249696EF420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000024967DFD950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000024969409F10>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000024967BD45E0>
           │    │          └ <openai.OpenAI object at 0x0000024967DFD950>
           │    └ ~ResponseT
           └ <function cast at 0x0000024963F44FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000024967BCED40>
          └ <openai.OpenAI object at 0x0000024967DFD950>

openai.BadRequestError: Error code: 400 - [{'error': {'code': 400, 'message': 'API key expired. Please renew the API key.', 'status': 'INVALID_ARGUMENT', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'API_KEY_INVALID', 'domain': 'googleapis.com', 'metadata': {'service': 'generativelanguage.googleapis.com'}}, {'@type': 'type.googleapis.com/google.rpc.LocalizedMessage', 'locale': 'en-US', 'message': 'API key expired. Please renew the API key.'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000024967E0C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000024967E0C0E0>
             └ <agent.ReportAgent object at 0x0000024967DFF310>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000024967E0C220>
                  └ <agent.ReportAgent object at 0x0000024967DFF310>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000024967D620C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002496935C8D0>
                   └ <agent.ReportAgent object at 0x0000024967DFF310>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x0000024967D622A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000002496935C8D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 18:59:05.797 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 18:59:05.799 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 18:59:05.799 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 18:59:05.819 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 18:59:05.820 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 18:59:05.820 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 18:59:05.821 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 18:59:05.821 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 18:59:05.822 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 18:59:05.823 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 18:59:05.823 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 18:59:05.824 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 18:59:05.824 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 18:59:05.824 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 18:59:08.063 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 50.588391085s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '50s'}]}}]
2025-12-07 18:59:08.064 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 50.588391085s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '50s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000208F0A7C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000208F0A7C0E0>
             └ <agent.ReportAgent object at 0x00000208F0FEB750>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000208F0A7C220>
                  └ <agent.ReportAgent object at 0x00000208F0FEB750>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000208F09D20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000208F0FE6DD0>
                   └ <agent.ReportAgent object at 0x00000208F0FEB750>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000208F09BB560>
               │    └ <llms.base.LLMClient object at 0x00000208F0A6D9D0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000208F0FE6DD0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000208F09BAFC0>
                 └ <llms.base.LLMClient object at 0x00000208F0A6D9D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000208F12CF600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000208F10A9FD0>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000208F10A9610>
             │    └ <openai.OpenAI object at 0x00000208F0FE5C50>
             └ <llms.base.LLMClient object at 0x00000208F0A6D9D0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000208F10A9FD0>,)
           └ <function Completions.create at 0x00000208F12CF420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000208F0FE5C50>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000208F10A9FD0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000208EF8745E0>
           │    │          └ <openai.OpenAI object at 0x00000208F0FE5C50>
           │    └ ~ResponseT
           └ <function cast at 0x00000208EBB64FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000208EF86ED40>
          └ <openai.OpenAI object at 0x00000208F0FE5C50>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 50.588391085s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '50s'}]}}]
2025-12-07 18:59:08.116 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 18:59:08.118 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000208F09BB560>
               │    └ <llms.base.LLMClient object at 0x00000208F0A6D9D0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000208F0FE6DD0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000208F09BAFC0>
                 └ <llms.base.LLMClient object at 0x00000208F0A6D9D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000208F12CF600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000208F10A9FD0>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000208F10A9610>
             │    └ <openai.OpenAI object at 0x00000208F0FE5C50>
             └ <llms.base.LLMClient object at 0x00000208F0A6D9D0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000208F10A9FD0>,)
           └ <function Completions.create at 0x00000208F12CF420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000208F0FE5C50>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000208F10A9FD0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000208EF8745E0>
           │    │          └ <openai.OpenAI object at 0x00000208F0FE5C50>
           │    └ ~ResponseT
           └ <function cast at 0x00000208EBB64FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000208EF86ED40>
          └ <openai.OpenAI object at 0x00000208F0FE5C50>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 50.588391085s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '50s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000208F0A7C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000208F0A7C0E0>
             └ <agent.ReportAgent object at 0x00000208F0FEB750>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000208F0A7C220>
                  └ <agent.ReportAgent object at 0x00000208F0FEB750>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000208F09D20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000208F0FE6DD0>
                   └ <agent.ReportAgent object at 0x00000208F0FEB750>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x00000208F09D22A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000208F0FE6DD0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 19:00:10.459 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 19:00:10.461 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 19:00:10.462 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 19:00:10.487 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 19:00:10.489 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 19:00:10.489 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 19:00:10.489 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 19:00:10.490 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 19:00:10.490 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 19:00:10.491 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 19:00:10.491 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 19:00:10.493 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 19:00:10.493 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 19:00:10.494 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 19:00:11.884 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 46.880959093s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '46s'}]}}]
2025-12-07 19:00:11.885 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 46.880959093s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '46s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000264D668C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000264D668C0E0>
             └ <agent.ReportAgent object at 0x00000264D787E490>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000264D668C220>
                  └ <agent.ReportAgent object at 0x00000264D787E490>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000264D65E20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000264D7BD29D0>
                   └ <agent.ReportAgent object at 0x00000264D787E490>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000264D65CB560>
               │    └ <llms.base.LLMClient object at 0x00000264D667D8D0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000264D7BD29D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000264D65CAFC0>
                 └ <llms.base.LLMClient object at 0x00000264D667D8D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000264D7F9F6A0>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000264D7C85D10>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000264D7BE06D0>
             │    └ <openai.OpenAI object at 0x00000264D7BD2410>
             └ <llms.base.LLMClient object at 0x00000264D667D8D0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000264D7C85D10>,)
           └ <function Completions.create at 0x00000264D7F9F4C0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000264D7BD2410>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000264D7C85D10>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000264D64545E0>
           │    │          └ <openai.OpenAI object at 0x00000264D7BD2410>
           │    └ ~ResponseT
           └ <function cast at 0x00000264D2794FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000264D644ED40>
          └ <openai.OpenAI object at 0x00000264D7BD2410>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 46.880959093s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '46s'}]}}]
2025-12-07 19:00:11.914 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 19:00:11.915 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000264D65CB560>
               │    └ <llms.base.LLMClient object at 0x00000264D667D8D0>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000264D7BD29D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000264D65CAFC0>
                 └ <llms.base.LLMClient object at 0x00000264D667D8D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000264D7F9F6A0>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000264D7C85D10>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000264D7BE06D0>
             │    └ <openai.OpenAI object at 0x00000264D7BD2410>
             └ <llms.base.LLMClient object at 0x00000264D667D8D0>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000264D7C85D10>,)
           └ <function Completions.create at 0x00000264D7F9F4C0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000264D7BD2410>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000264D7C85D10>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000264D64545E0>
           │    │          └ <openai.OpenAI object at 0x00000264D7BD2410>
           │    └ ~ResponseT
           └ <function cast at 0x00000264D2794FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000264D644ED40>
          └ <openai.OpenAI object at 0x00000264D7BD2410>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\nPlease retry in 46.880959093s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '46s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000264D668C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000264D668C0E0>
             └ <agent.ReportAgent object at 0x00000264D787E490>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000264D668C220>
                  └ <agent.ReportAgent object at 0x00000264D787E490>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000264D65E20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000264D7BD29D0>
                   └ <agent.ReportAgent object at 0x00000264D787E490>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x00000264D65E22A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000264D7BD29D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 19:01:13.471 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 19:01:13.474 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 19:01:13.475 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 19:01:13.514 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 19:01:13.515 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 19:01:13.516 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 19:01:13.517 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 19:01:13.518 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 19:01:13.518 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 19:01:13.519 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 19:01:13.521 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 19:01:13.522 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 19:01:13.522 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 19:01:13.523 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 19:01:15.044 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 43.62129946s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '43s'}]}}]
2025-12-07 19:01:15.045 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 43.62129946s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '43s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000022C5C15C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000022C5C15C0E0>
             └ <agent.ReportAgent object at 0x0000022C5C14F310>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000022C5C15C220>
                  └ <agent.ReportAgent object at 0x0000022C5C14F310>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000022C5C0B20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000022C5D692210>
                   └ <agent.ReportAgent object at 0x0000022C5C14F310>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000022C5C09B560>
               │    └ <llms.base.LLMClient object at 0x0000022C5D34DD50>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000022C5D692210>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000022C5C09AFC0>
                 └ <llms.base.LLMClient object at 0x0000022C5D34DD50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x0000022C5D96F600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000022C5D759F10>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000022C5D75A050>
             │    └ <openai.OpenAI object at 0x0000022C5C14D950>
             └ <llms.base.LLMClient object at 0x0000022C5D34DD50>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000022C5D759F10>,)
           └ <function Completions.create at 0x0000022C5D96F420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000022C5C14D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000022C5D759F10>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000022C5BF245E0>
           │    │          └ <openai.OpenAI object at 0x0000022C5C14D950>
           │    └ ~ResponseT
           └ <function cast at 0x0000022C581D4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000022C5BF1ED40>
          └ <openai.OpenAI object at 0x0000022C5C14D950>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 43.62129946s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '43s'}]}}]
2025-12-07 19:01:15.070 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 19:01:15.070 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x0000022C5C09B560>
               │    └ <llms.base.LLMClient object at 0x0000022C5D34DD50>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000022C5D692210>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x0000022C5C09AFC0>
                 └ <llms.base.LLMClient object at 0x0000022C5D34DD50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x0000022C5D96F600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000022C5D759F10>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x0000022C5D75A050>
             │    └ <openai.OpenAI object at 0x0000022C5C14D950>
             └ <llms.base.LLMClient object at 0x0000022C5D34DD50>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000022C5D759F10>,)
           └ <function Completions.create at 0x0000022C5D96F420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000022C5C14D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000022C5D759F10>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x0000022C5BF245E0>
           │    │          └ <openai.OpenAI object at 0x0000022C5C14D950>
           │    └ ~ResponseT
           └ <function cast at 0x0000022C581D4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x0000022C5BF1ED40>
          └ <openai.OpenAI object at 0x0000022C5C14D950>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 43.62129946s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'model': 'gemini-2.0-flash', 'location': 'global'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '43s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x0000022C5C15C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x0000022C5C15C0E0>
             └ <agent.ReportAgent object at 0x0000022C5C14F310>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x0000022C5C15C220>
                  └ <agent.ReportAgent object at 0x0000022C5C14F310>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x0000022C5C0B20C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000022C5D692210>
                   └ <agent.ReportAgent object at 0x0000022C5C14F310>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x0000022C5C0B22A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x0000022C5D692210>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 19:04:12.418 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 19:04:12.420 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 19:04:12.420 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 19:04:12.461 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 19:04:12.462 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 19:04:12.463 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 19:04:12.464 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 19:04:12.465 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 19:04:12.466 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 19:04:12.467 | INFO     | nodes.template_selection_node:_get_fallback_template:239 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 19:04:12.468 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 19:04:12.469 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 19:04:12.470 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 19:04:12.470 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 19:04:13.740 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 44.949625657s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '44s'}]}}]
2025-12-07 19:04:13.742 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 44.949625657s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '44s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000221D9B2C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000221D9B2C0E0>
             └ <agent.ReportAgent object at 0x00000221DA09F3D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000221D9B2C220>
                  └ <agent.ReportAgent object at 0x00000221DA09F3D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000221D9A820C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000221DA0B0390>
                   └ <agent.ReportAgent object at 0x00000221DA09F3D0>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000221D9A6B560>
               │    └ <llms.base.LLMClient object at 0x00000221D9D4DD10>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000221DA0B0390>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000221D9A6AFC0>
                 └ <llms.base.LLMClient object at 0x00000221D9D4DD10>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000221DA37F600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000221DA15B890>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000221DA15B510>
             │    └ <openai.OpenAI object at 0x00000221D9B1D950>
             └ <llms.base.LLMClient object at 0x00000221D9D4DD10>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000221DA15B890>,)
           └ <function Completions.create at 0x00000221DA37F420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000221D9B1D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000221DA15B890>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000221D89145E0>
           │    │          └ <openai.OpenAI object at 0x00000221D9B1D950>
           │    └ ~ResponseT
           └ <function cast at 0x00000221D4BD4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000221D890ED40>
          └ <openai.OpenAI object at 0x00000221D9B1D950>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 44.949625657s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '44s'}]}}]
2025-12-07 19:04:13.780 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 19:04:13.782 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x00000221D9A6B560>
               │    └ <llms.base.LLMClient object at 0x00000221D9D4DD10>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000221DA0B0390>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x00000221D9A6AFC0>
                 └ <llms.base.LLMClient object at 0x00000221D9D4DD10>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x00000221DA37F600>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000221DA15B890>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x00000221DA15B510>
             │    └ <openai.OpenAI object at 0x00000221D9B1D950>
             └ <llms.base.LLMClient object at 0x00000221D9D4DD10>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000221DA15B890>,)
           └ <function Completions.create at 0x00000221DA37F420>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000221D9B1D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000221DA15B890>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000221D89145E0>
           │    │          └ <openai.OpenAI object at 0x00000221D9B1D950>
           │    └ ~ResponseT
           └ <function cast at 0x00000221D4BD4FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000221D890ED40>
          └ <openai.OpenAI object at 0x00000221D9B1D950>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 44.949625657s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '44s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x00000221D9B2C9A0>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x00000221D9B2C0E0>
             └ <agent.ReportAgent object at 0x00000221DA09F3D0>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x00000221D9B2C220>
                  └ <agent.ReportAgent object at 0x00000221DA09F3D0>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x00000221D9A820C0>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000221DA0B0390>
                   └ <agent.ReportAgent object at 0x00000221DA09F3D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x00000221D9A822A0>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x00000221DA0B0390>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
2025-12-07 19:12:11.737 | INFO     | agent:initialize_baseline:62 - 文件数量基准已初始化: {'insight': 0, 'media': 0, 'query': 0}
2025-12-07 19:12:11.739 | INFO     | agent:__init__:143 - Report Agent已初始化
2025-12-07 19:12:11.739 | INFO     | agent:__init__:144 - 使用LLM: {'provider': 'gemini-2.0-flash', 'model': 'gemini-2.0-flash', 'api_base': 'https://generativelanguage.googleapis.com/v1beta'}
2025-12-07 19:12:11.769 | INFO     | agent:generate_report:197 - 开始生成报告: Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current performance, profit/loss analysis, and recommendations. Total P&L: ₹-7,719.45
2025-12-07 19:12:11.770 | INFO     | agent:generate_report:198 - 输入数据 - 报告数量: 3, 论坛日志长度: 250
2025-12-07 19:12:11.771 | INFO     | agent:_select_template:226 - 选择报告模板...
2025-12-07 19:12:11.772 | INFO     | nodes.template_selection_node:run:42 - 开始模板选择...
2025-12-07 19:12:11.773 | ERROR    | nodes.template_selection_node:_get_available_templates:193 - 模板目录不存在: ReportEngine/report_template
2025-12-07 19:12:11.774 | INFO     | nodes.template_selection_node:run:52 - 未找到预设模板，使用内置默认模板
2025-12-07 19:12:11.774 | INFO     | nodes.template_selection_node:_get_fallback_template:256 - 未找到合适模板，使用空模板让LLM自行发挥
2025-12-07 19:12:11.775 | INFO     | agent:_select_template:249 - 选择模板: 自由发挥模板
2025-12-07 19:12:11.775 | INFO     | agent:_select_template:250 - 选择理由: 未找到合适的预设模板，让LLM根据内容自行设计报告结构
2025-12-07 19:12:11.776 | INFO     | agent:_generate_html_report:266 - 多轮生成HTML报告...
2025-12-07 19:12:11.777 | INFO     | nodes.html_generation_node:run:46 - 开始生成HTML报告...
2025-12-07 19:12:13.309 | ERROR    | llms.base:stream_invoke:117 - 流式请求失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 45.449260296s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '45s'}]}}]
2025-12-07 19:12:13.310 | ERROR    | nodes.html_generation_node:run:72 - HTML生成失败: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 45.449260296s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '45s'}]}}]
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x000001FC3342CA40>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x000001FC3342C180>
             └ <agent.ReportAgent object at 0x000001FC34615190>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x000001FC3342C2C0>
                  └ <agent.ReportAgent object at 0x000001FC34615190>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x000001FC33382160>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001FC349848D0>
                   └ <agent.ReportAgent object at 0x000001FC34615190>

> File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x000001FC3336B560>
               │    └ <llms.base.LLMClient object at 0x000001FC3341EF50>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001FC349848D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x000001FC3336AFC0>
                 └ <llms.base.LLMClient object at 0x000001FC3341EF50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x000001FC34CCF6A0>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001FC34A2A050>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x000001FC34A2A310>
             │    └ <openai.OpenAI object at 0x000001FC34965B50>
             └ <llms.base.LLMClient object at 0x000001FC3341EF50>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001FC34A2A050>,)
           └ <function Completions.create at 0x000001FC34CCF4C0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001FC34965B50>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001FC34A2A050>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001FC331F45E0>
           │    │          └ <openai.OpenAI object at 0x000001FC34965B50>
           │    └ ~ResponseT
           └ <function cast at 0x000001FC2F464FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001FC331EED40>
          └ <openai.OpenAI object at 0x000001FC34965B50>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 45.449260296s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '45s'}]}}]
2025-12-07 19:12:13.343 | INFO     | nodes.html_generation_node:_generate_fallback_html:144 - 使用备用HTML生成方法
2025-12-07 19:12:13.344 | ERROR    | agent:generate_report:221 - 报告生成过程中发生错误: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 63, in run
    response = self.llm_client.stream_invoke_to_string(SYSTEM_PROMPT_HTML_GENERATION, message)
               │    │          │                       │                              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
               │    │          │                       └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
               │    │          └ <function LLMClient.stream_invoke_to_string at 0x000001FC3336B560>
               │    └ <llms.base.LLMClient object at 0x000001FC3341EF50>
               └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001FC349848D0>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 135, in stream_invoke_to_string
    for chunk in self.stream_invoke(system_prompt, user_prompt, **kwargs):
                 │    │             │              │              └ {}
                 │    │             │              └ '{\n  "query": "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com\'s investment portfolio sho...
                 │    │             └ '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告模板，需要生成一份不少于3万字的完整的HTML格式分析报告。\n\n<INPUT JSON SCHEMA>\n{\n  "type": "obje...
                 │    └ <function LLMClient.stream_invoke at 0x000001FC3336AFC0>
                 └ <llms.base.LLMClient object at 0x000001FC3341EF50>

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 118, in stream_invoke
    raise e

  File "C:\Darshan\stockanalysis\ReportEngine\llms\base.py", line 104, in stream_invoke
    stream = self.client.chat.completions.create(
             │    │      │    │           └ <function Completions.create at 0x000001FC34CCF6A0>
             │    │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001FC34A2A050>
             │    │      └ <openai.resources.chat.chat.Chat object at 0x000001FC34A2A310>
             │    └ <openai.OpenAI object at 0x000001FC34965B50>
             └ <llms.base.LLMClient object at 0x000001FC3341EF50>

  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gemini-2.0-flash', 'messages': [{'role': 'system', 'content': '\n你是一位专业的HTML报告生成专家。你将接收来自三个分析引擎的报告内容、论坛监控日志以及选定的报告...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001FC34A2A050>,)
           └ <function Completions.create at 0x000001FC34CCF4C0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1189, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001FC34965B50>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001FC34A2A050>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ True
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=3000...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001FC331F45E0>
           │    │          └ <openai.OpenAI object at 0x000001FC34965B50>
           │    └ ~ResponseT
           └ <function cast at 0x000001FC2F464FE0>
  File "C:\Users\darsh\AppData\Local\Programs\Python\Python311\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001FC331EED40>
          └ <openai.OpenAI object at 0x000001FC34965B50>

openai.RateLimitError: Error code: 429 - [{'error': {'code': 429, 'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\n* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: gemini-2.0-flash\nPlease retry in 45.449260296s.', 'status': 'RESOURCE_EXHAUSTED', 'details': [{'@type': 'type.googleapis.com/google.rpc.Help', 'links': [{'description': 'Learn more about Gemini API quotas', 'url': 'https://ai.google.dev/gemini-api/docs/rate-limits'}]}, {'@type': 'type.googleapis.com/google.rpc.QuotaFailure', 'violations': [{'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_input_token_count', 'quotaId': 'GenerateContentInputTokensPerModelPerMinute-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerMinutePerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}, {'quotaMetric': 'generativelanguage.googleapis.com/generate_content_free_tier_requests', 'quotaId': 'GenerateRequestsPerDayPerProjectPerModel-FreeTier', 'quotaDimensions': {'location': 'global', 'model': 'gemini-2.0-flash'}}]}, {'@type': 'type.googleapis.com/google.rpc.RetryInfo', 'retryDelay': '45s'}]}}]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 383, in <module>
    generate_daily_reports()
    └ <function generate_daily_reports at 0x000001FC3342CA40>

  File "C:\Darshan\stockanalysis\ReportEngine\test.py", line 313, in generate_daily_reports
    report = agent.generate_report(
             │     └ <function ReportAgent.generate_report at 0x000001FC3342C180>
             └ <agent.ReportAgent object at 0x000001FC34615190>

> File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 205, in generate_report
    html_report = self._generate_html_report(query, reports, forum_logs, template_result)
                  │    │                     │      │        │           └ {'template_name': '自由发挥模板', 'template_content': '', 'selection_reason': '未找到合适的预设模板，让LLM根据内容自行设计报告结构'}
                  │    │                     │      │        └ '\n[ForumHost]: Daily portfolio report for darshanjain15062002@gmail.com - 2025-12-07\n[PortfolioAgent]: Analyzed 9 holdings ...
                  │    │                     │      └ [{'type': 'portfolio', 'summary': 'Portfolio of 9 stocks with total value ₹196,929.33. Overall P&L: ₹-7,719.45 (-3.77%)', 'ke...
                  │    │                     └ "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing current per...
                  │    └ <function ReportAgent._generate_html_report at 0x000001FC3342C2C0>
                  └ <agent.ReportAgent object at 0x000001FC34615190>

  File "C:\Darshan\stockanalysis\ReportEngine\agent.py", line 288, in _generate_html_report
    html_content = self.html_generation_node.run(html_input)
                   │    │                    │   └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
                   │    │                    └ <function HTMLGenerationNode.run at 0x000001FC33382160>
                   │    └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001FC349848D0>
                   └ <agent.ReportAgent object at 0x000001FC34615190>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 74, in run
    return self._generate_fallback_html(input_data)
           │    │                       └ {'query': "Generate a comprehensive daily portfolio report for darshanjain15062002@gmail.com's investment portfolio showing c...
           │    └ <function HTMLGenerationNode._generate_fallback_html at 0x000001FC33382340>
           └ <nodes.html_generation_node.HTMLGenerationNode object at 0x000001FC349848D0>

  File "C:\Darshan\stockanalysis\ReportEngine\nodes\html_generation_node.py", line 152, in _generate_fallback_html
    generation_time = datetime.now().strftime("%Y年%m月%d日 %H:%M:%S")
                      │        └ <method 'now' of 'datetime.datetime' objects>
                      └ <class 'datetime.datetime'>

UnicodeEncodeError: 'locale' codec can't encode character '\u5e74' in position 2: encoding error
